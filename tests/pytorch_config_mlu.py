from torch_dipu.testing._internal import common_utils

TEST_PRECISIONS = {
    # test_name : floating_precision,
    'test_pow_dipu_float32': 0.0035,
    'test_pow_dipu_float64': 0.0045,
    'test_var_neg_dim_dipu_bfloat16': 0.01,
    'test_sum_dipu_bfloat16': 0.1,
}

DISABLED_TESTS_MLU = {
    # test_view_ops.py
    'TestViewOpsDIPU': {
        'test_contiguous_nonview',
        'test_expand_as_view',
        'test_expand_view',
        'test_reshape_nonview',
        'test_unfold_view',
        'test_advanced_indexing_nonview_dipu',
        'test_as_strided_gradients_dipu',
        'test_unbind_dipu',
        'test_view_copy_dipu',
    },
    
    # test/test_view_ops.py
    'TestOldViewOpsDIPU': {
        'test_atleast',
        'test_broadcast_to',
        'test_contiguous',
        'test_flatten',
        'test_ravel',
        'test_reshape_view_semantics',
        'test_transpose_vs_numpy',
        'test_transposes',
        'test_transposes_errors'
    },

    # test_indexing.py
    'TestIndexingDIPU': {
        'test_setitem_expansion_error',  
        'test_setitem_scalars',  
        'test_multiple_byte_mask',  
        'test_empty_slice',  
        'test_byte_tensor_assignment',  
        'test_byte_mask', 
        'test_byte_mask_accumulate', 
        'test_bool_indices',  
        'test_index_getitem_copy_bools_slices',  
        'test_index_setitem_bools_slices', 
        'test_getitem_scalars', 
        'test_empty_ndim_index',  
        'test_index_put_byte_indices_dipu', 
        'test_index_put_accumulate_large_tensor_dipu'
    },

    # test_indexing.py
    'NumpyTestsDIPU': {
        'test_trivial_fancy_out_of_bounds',  
        'test_boolean_assignment_value_mismatch', 
        'test_empty_tuple_index',  
        'test_empty_fancy_index',  
        'test_ellipsis_index',  
        'test_boolean_indexing_alldims',
        'test_boolean_indexing_onedim',
        'test_boolean_indexing_twodim',
        'test_boolean_list_indexing',
        'test_single_bool_index',
        'test_broaderrors_indexing',  
        'test_boolean_shape_mismatch',  
        'test_boolean_indexing_weirdness',  
        'test_boolean_indexing_weirdness_tensors',  
    },
    
    # test/nn/test_pooling.py
    'TestPoolingNNDeviceTypeDIPU': {
        'test_adaptive_pooling_max_nhwc',
        'test_maxpool3d_non_square_backward',
        'test_pooling_max_nhwc',
        'test_MaxPool1d_indices',
        'test_maxpool_indices_no_batch_dim'
    },
    
    # test/nn/test_convolution.py
    'TestConvolutionNNDeviceTypeDIPU': {
        'test_conv1d_same_padding_backward',
        'test_conv1d_same_padding',
        'test_conv1d_valid_padding_backward',
        'test_conv1d_valid_padding',
        'test_conv3d_same_padding_backward',
        'test_conv3d_same_padding',
        'test_conv3d_valid_padding_backward',
        'test_conv3d_valid_padding',
        'test_conv_double_backward_strided_with_3D_input_and_weight',
        'test_conv_empty_channel',
        'test_conv_noncontig_weights_and_bias',
        'test_conv_noncontig_weights',
        'test_conv_transpose_with_output_size_and_no_batch_dim_ConvTranspose2d',
        'test_conv_transpose_with_output_size_and_no_batch_dim_ConvTranspose3d',
        'test_group_conv_empty',
        'test_conv_transpose_with_output_size_and_no_batch_dim',
    },
    
    # test/test_unary_ufuncs.py
    'TestUnaryUfuncsDIPU': {
        'test_nan_to_num',
        'test_nan_to_num_bfloat16',
        'test_complex_edge_values',
        'test_digamma_special',
        'test_digamma',
        'test_frexp',
        'test_frexp_assert_raises',
        'test_polygamma_neg',
        'test_op_invert',
        'test_abs_angle_complex_to_float',
        'check_internal_mem_overlap',
        'test_unary_out_op_mem_overlap',
        'test_hardshrink',
        'test_hardshrink_edge_cases',
        'test_exp_slow',
        'test_hardswish',
        'test_hardsigmoid',
        'test_hardsigmoid_backward',
        'test_silu',
        'test_sinc',
        'test_mish',
        'test_log1p_complex',
        'test_threshold',
        'test_igamma_common',
        'test_igammac_common',
        'test_igamma_edge_cases',
        'test_igammac_edge_cases',
        'test_i0_range1',
        'test_i0_range2',
        'test_i0_range3',
        'test_i0_special',
        'test_special_i0_i1_vs_scipy',
        'test_special_ndtr_vs_scipy',
        'test_special_log_ndtr_vs_scipy',
        'test_isposinf_isneginf_non_boolean_output',
        'test_exp'
    },
    
    # test/test_binary_ufuncs.py
    'TestBinaryUfuncsDIPU': {
        'test_addcmul_scalars_as_floats',
        'test_bitwise_ops',
        'test_cross_device_inplace_error_msg',
        'test_out_resize_warning',
        'test_inplace_dunders',
        'test_logical_xor_with_nontrivial_alignment',
        'test_cross_device_binary_ops',
        'test_binary_op_scalar_device_unspecified',
        'test_binary_ops_with_scalars',
        'test_maximum_minimum_type_promotion',
        'test_maximum_minimum_int_and_bool',
        'test_maximum_minimum_float',
        'test_maximum_minimum_float_nan_and_inf',
        'test_maximum_minimum_complex',
        'test_maximum_minimum_cross_device',
        'test_maximum_and_minimum_subgradient',
        'test_maximum_minimum_forward_ad_float32',
        'test_copysign',
        'test_copysign_subgradient',
        'test_fmod_remainder_by_zero_float',
        'test_fmod_remainder_by_zero_integral',
        'test_fmod_remainder',
        'test_remainder_fmod_large_dividend',
        'test_hypot',
        'test_gcd',
        'test_lcm',
        'test_nextafter',
        'test_nextafter_bfloat16',
        'test_cremainder',
        'test_comparison_ops_type_promotion_and_broadcasting',
        'test_signed_shift',
        'test_heaviside',
        'test_heaviside_cross_device',
        'test_heaviside_complex',
        'test_logical_xor',
        'test_logical_and',
        'test_logical_or',
        'test_remainder_overflow',
        'test_ldexp',
        'test_lerp',
        'test_lerp_lowp',
        'test_lerp_lowp_cpu',
        'test_logaddexp',
        'test_logaddexp2',
        'test_logical',
        'test_atan2',
        'test_atan2_edgecases',
        'test_trapezoid',
        'test_cumulative_trapezoid',
        'test_float_power',
        'test_float_power_exceptions',
        'test_xlogy_xlog1py',
        'test_xlogy_xlog1py_gradients',
        'test_xlogy_xlog1py_scalar_type_promotion',
        'test_xlogy_xlog1py_bfloat16',
        'test_zeta',
    },
    
    # test/test_linalg.py
    'TestLinalgDIPU': {
        'test_addbmm',
        'test_addmv',
        'test_addmv_rowmajor_colmajor_incx_incy_lda',
        'test_addr_bool',
        'test_addr_float_and_complex',
        'test_addr_integral',
        'test_addr_type_promotion',
        'test_baddbmm',
        'test_blas_alpha_beta_empty',
        'test_blas_empty',
        'test_blas_mv_large_input',
        'test_blas_nan_out',
        'test_bmm',
        'test_broadcast_batched_matmul',
        'test_broadcast_fused_matmul',
        'test_chain_matmul',
        'test_cholesky',
        'test_cholesky_errors_and_warnings',
        'test_cholesky_ex',
        'test_cholesky_ex_non_pd',
        'test_cholesky_inverse',
        'test_cholesky_inverse_errors_and_warnings',
        'test_cholesky_solve',
        'test_cholesky_solve_batched',
        'test_cholesky_solve_batched_broadcasting',
        'test_cholesky_solve_batched_many_batches',
        'test_cholesky_solve_out_errors_and_warnings',
        'test_cond',
        'test_cond_errors_and_warnings',
        'test_corner_cases_of_cublasltmatmul',
        'test_cross',
        'test_cross_with_and_without_dim',
        'test_det',
        'test_det_logdet_slogdet',
        'test_det_logdet_slogdet_batched',
        'test_dot_invalid_args',
        'test_dot_vs_numpy',
        'test_eig_check_magma',
        'test_eig_compare_backends',
        'test_eig_errors_and_warnings',
        'test_eig_numpy',
        'test_eig_removed_error',
        'test_eig_with_nan',
        'test_eigh',
        'test_eigh_errors_and_warnings',
        'test_eigh_lower_uplo',
        'test_eigvals_compare_backends',
        'test_eigvals_errors_and_warnings',
        'test_eigvals_numpy',
        'test_eigvalsh',
        'test_eigvalsh_errors_and_warnings',
        'test_einsum',
        'test_einsum_corner_cases',
        'test_einsum_error_cases',
        'test_einsum_random',
        'test_einsum_sublist_format',
        'test_geqrf',
        'test_householder_product',
        'test_householder_product_errors_and_warnings',
        'test_inner',
        'test_inv_errors_and_warnings',
        'test_inv_ex_info_device',
        'test_inv_ex_singular',
        'test_invariance_error_spectral_decompositions',
        'test_inverse',
        'test_inverse_errors',
        'test_inverse_errors_large',
        'test_inverse_many_batches',
        'test_kron',
        'test_kron_empty',
        'test_kron_errors_and_warnings',
        'test_lapack_empty',
        'test_ldl_factor',
        'test_ldl_solve',
        'test_linalg_cross',
        'test_linalg_cross_with_and_without_dim',
        'test_linalg_lstsq',
        'test_linalg_lstsq_batch_broadcasting',
        'test_linalg_lstsq_input_checks',
        'test_linalg_lu_cpu_errors',
        'test_linalg_lu_family',
        'test_linalg_lu_solve',
        'test_linalg_matrix_exp_analytic',
        'test_linalg_matrix_exp_batch',
        'test_linalg_matrix_exp_boundary_cases',
        'test_linalg_matrix_exp_compare_with_taylor',
        'test_linalg_matrix_exp_no_warnings',
        'test_linalg_matrix_exp_utils',
        'test_linalg_qr_autograd_errors',
        'test_linalg_solve_triangular',
        'test_linalg_solve_triangular_broadcasting',
        'test_linalg_solve_triangular_large',
        'test_lobpcg_basic',
        'test_lobpcg_ortho',
        'test_lobpcg_scipy',
        'test_lobpcg_torchscript',
        'test_lstsq_removed_error',
        'test_lu_solve',
        'test_lu_solve_batched',
        'test_lu_solve_batched_broadcasting',
        'test_lu_solve_batched_many_batches',
        'test_lu_solve_large_matrices',
        'test_lu_unpack_check_input',
        'test_matmul_45724',
        'test_matmul_small_brute_force_1d_Nd',
        'test_matmul_small_brute_force_2d_Nd',
        'test_matmul_small_brute_force_3d_Nd',
        'test_matrix_norm',
        'test_matrix_power_negative',
        'test_matrix_power_non_negative',
        'test_matrix_rank',
        'test_matrix_rank_atol',
        'test_matrix_rank_atol_rtol',
        'test_matrix_rank_basic',
        'test_matrix_rank_empty',
        'test_matrix_rank_out_errors_and_warnings',
        'test_matrix_rank_removed_error',
        'test_mm',
        'test_mm_bmm_non_memory_dense',
        'test_multi_dot',
        'test_multi_dot_errors',
        'test_norm_complex',
        'test_norm_complex_old',
        'test_norm_dtype',
        'test_norm_errors',
        'test_norm_extreme_values',
        'test_norm_fastpaths',
        'test_norm_fro_2_equivalence_old',
        'test_norm_fused_type_promotion',
        'test_norm_matrix',
        'test_norm_matrix_degenerate_shapes',
        'test_norm_old',
        'test_norm_old_nan_propagation',
        'test_norm_vector',
        'test_norm_vector_degenerate_shapes',
        'test_nuclear_norm_axes_small_brute_force_old',
        'test_nuclear_norm_exceptions_old',
        'test_nuclear_norm_out',
        'test_old_cholesky',
        'test_old_cholesky_batched',
        'test_old_cholesky_batched_many_batches',
        'test_old_cholesky_batched_upper',
        'test_old_cholesky_empty',
        'test_ormqr',
        'test_ormqr_errors_and_warnings',
        'test_outer',
        'test_outer_ger_addr_legacy_tests',
        'test_outer_type_promotion',
        'test_pca_lowrank',
        'test_pinv',
        'test_pinv_errors_and_warnings',
        'test_pinverse',
        'test_preferred_linalg_library',
        'test_qr',
        'test_qr_batched',
        'test_qr_error_cases',
        'test_qr_vs_numpy',
        'test_renorm',
        'test_renorm_ps',
        'test_slogdet',
        'test_slogdet_errors_and_warnings',
        'test_solve',
        'test_solve_batched_broadcasting',
        'test_solve_removed_error',
        'test_strided_mm_bmm',
        'test_svd',
        'test_svd_lowrank',
        'test_svd_memory_allocation',
        'test_symeig_removed_error',
        'test_tensordot',
        'test_tensorinv',
        'test_tensorinv_empty',
        'test_tensorinv_errors_and_warnings',
        'test_tensorinv_singular_input',
        'test_tensorsolve',
        'test_tensorsolve_empty',
        'test_tensorsolve_errors_and_warnings',
        'test_triangular_solve',
        'test_triangular_solve_batched',
        'test_triangular_solve_batched_broadcasting',
        'test_triangular_solve_batched_many_batches',
        'test_triangular_solve_out_errors_and_warnings',
        'test_vdot_invalid_args',
        'test_vdot_vs_numpy',
        'test_vector_norm',
        'test_vector_norm_dim_tuple_arg',
        'test_vector_norm_extreme_values',
    },
    
    # test/test_tensor_creation_ops.py
    'TestTensorCreationDIPU': {
        'test_as_strided_neg',
        'test_as_tensor',
        'test_block_diag',
        'test_block_diag_scipy',
        'test_cartesian_prod',
        'test_combinations',
        'test_complex_type_conversions',
        'test_constructor_device_legacy',
        'test_constructor_dtypes',
        'test_ctor_with_numpy_array',
        'test_device_rounding',
        'test_diag_embed',
        'test_diagflat',
        'test_dsplit',
        'test_dstack',
        'test_empty_full',
        'test_empty_overflow',
        'test_empty_strided',
        'test_empty_tensor_props',
        'test_eye',
        'test_fill_all_dtypes_and_devices',
        'test_float_to_int_conversion_finite',
        'test_float_to_int_conversion_nonfinite',
        'test_full_inference',
        'test_full_out',
        'test_hsplit',
        'test_hstack_column_stack',
        'test_kaiser_window',
        'test_large_linspace',
        'test_like_fn_stride_proparation_vs_tensoriterator_unary_op',
        'test_linlogspace_mem_overlap',
        'test_linspace',
        'test_linspace_deduction',
        'test_linspace_device_vs_cpu',
        'test_linspace_special_steps',
        'test_linspace_vs_numpy',
        'test_linspace_vs_numpy_complex',
        'test_linspace_vs_numpy_integral',
        'test_logspace',
        'test_logspace_base2',
        'test_logspace_deduction',
        'test_logspace_device_vs_cpu',
        'test_logspace_special_steps',
        'test_logspace_vs_numpy',
        'test_logspace_vs_numpy_complex',
        'test_meshgrid_default_indexing',
        'test_meshgrid_empty',
        'test_meshgrid_ij_indexing',
        'test_meshgrid_ij_indexing_is_default',
        'test_meshgrid_inconsistent_device',
        'test_meshgrid_inconsistent_dtype',
        'test_meshgrid_non_1d_tensor',
        'test_meshgrid_unsupported_indexing',
        'test_meshgrid_vs_numpy',
        'test_meshgrid_warns_if_no_indexing',
        'test_meshgrid_xy_indexing',
        'test_new_empty_strided',
        'test_new_methods_requires_grad',
        'test_new_tensor',
        'test_offset_scalar_cast',
        'test_ones',
        'test_range',
        'test_range_factories_64bit_indexing',
        'test_range_warning',
        'test_repeat_interleave',
        'test_roll',
        'test_signal_window_functions',
        'test_simple_scalar_cast',
        'test_strided_mismatched_stride_shape',
        'test_tensor_ctor_device_inference',
        'test_tensor_device',
        'test_tensor_factories_empty',
        'test_tensor_factory',
        'test_tensor_factory_copy_var',
        'test_tensor_factory_gpu_type',
        'test_tensor_factory_gpu_type_inference',
        'test_tensor_factory_type_inference',
        'test_tensor_from_non_writable_numpy',
        'test_tensor_from_sequence',
        'test_torch_complex',
        'test_torch_complex_floating_dtype_error',
        'test_torch_complex_out_dtype_error',
        'test_torch_complex_same_dtype_error',
        'test_torch_polar',
        'test_unpack_double',
        'test_vander',
        'test_vander_types',
        'test_vsplit',
        'test_vstack_row_stack',
        'test_zeros',
        'test_zeros_dtype_layout_device_match',
        'test_zeros_out',
    },
    
    # test/test_tensor_creation_ops.py
    'TestRandomTensorCreationDIPU': {
        'test_normal',
        'test_normal_std_error',
        'test_rand',
        'test_randint',
        'test_randint_inference',
        'test_randn',
        'test_uniform_from_to',
    },
    
    # test/test_tensor_creation_ops.py
    'TestLikeTensorCreationDIPU': {
        'test_empty_like',
        'test_full_like_inference',
        'test_ones_like',
        'test_ones_like_multiple_device',
        'test_zeros_like',
        'test_zeros_like_multiple_device',
    },
    
    # test/test_tensor_creation_ops.py
    'TestAsArrayDIPU': {
        'test_alias_from_buffer',
        'test_alias_from_dlpack',
        'test_alias_from_numpy',
        'test_alias_from_tensor',
        'test_astensor_consistency',
        'test_copy_from_buffer',
        'test_copy_from_dlpack',
        'test_copy_from_dlpack_mult_devices',
        'test_copy_from_numpy',
        'test_copy_from_tensor_mult_devices',
        'test_copy_list',
        'test_copy_tensor',
        'test_numpy_scalars',
        'test_retain_autograd_history',
        'test_unsupported_alias',
        'test_unsupported_alias_mult_devices',
    },
    
    # test/test_nn.py
    'TestNNDeviceTypeDIPU': {
        'test_Bilinear_empty',
        'test_CTCLoss_cudnn',
        'test_CTCLoss_empty_target',
        'test_CTCLoss_no_batch_dim',
        'test_GRU_grad_and_gradgrad',
        'test_GroupNorm_empty',
        'test_GroupNorm_general',
        'test_GroupNorm_memory_format',
        'test_GroupNorm_numeric',
        'test_GroupNorm_raises_error_if_one_value_per_group',
        'test_InstanceNorm1d_general',
        'test_InstanceNorm2d_general',
        'test_InstanceNorm3d_general',
        'test_LSTM_grad_and_gradgrad',
        'test_LayerNorm_general',
        'test_LayerNorm_numeric',
        'test_LocalResponseNorm_empty',
        'test_MarginLoss_empty',
        'test_ReflectionPad2d_large',
        'test_ReflectionPad3d_large',
        'test_ReflectionPad_empty',
        'test_ReplicationPad1d_large',
        'test_ReplicationPad2d_large',
        'test_ReplicationPad3d_large',
        'test_ReplicationPad_empty',
        'test_TransformerDecoderLayer_empty',
        'test_TransformerDecoder_empty',
        'test_TransformerEncoderLayer_empty',
        'test_TransformerEncoder_empty',
        'test_Transformer_empty',
        'test_Unfold_empty',
        'test_activations_bfloat16',
        'test_activations_bfloat16_cpu',
        'test_affine_2d_rotate0',
        'test_affine_2d_rotate45',
        'test_affine_2d_rotate90',
        'test_affine_2d_rotateRandom',
        'test_affine_3d_rotateRandom',
        'test_clip_grad_norm',
        'test_clip_grad_norm_error_if_nonfinite',
        'test_clip_grad_norm_multi_device',
        'test_clip_grad_value',
        'test_conv_empty_input',
        'test_ctc_loss',
        'test_ctc_loss_cudnn',
        'test_device_mask',
        'test_elu_inplace_overlap',
        'test_elu_inplace_with_neg_alpha',
        'test_fold',
        'test_glu_bfloat16',
        'test_grid_sample_half_precision',
        'test_grid_sample_large',
        'test_grid_sample_large_index_2d',
        'test_grid_sample_large_index_3d',
        'test_grid_sample_nan_inf',
        'test_groupnorm_nhwc',
        'test_gumbel_softmax',
        'test_hardsigmoid_grad',
        'test_hardswish_grad',
        'test_hardswish_inplace_overlap',
        'test_instancenorm_raises_error_for_single_spatial_element_during_training',
        'test_instancenorm_raises_error_if_less_than_one_value_per_channel',
        'test_invalid_reduction_strings',
        'test_layernorm_half_precision',
        'test_layernorm_weight_bias',
        'test_leaky_relu_inplace_overlap',
        'test_leaky_relu_inplace_with_neg_slope',
        'test_leaky_relu_inplace_with_zero_slope',
        'test_logsigmoid_out',
        'test_lstmcell_backward_only_one_output_grad',
        'test_masked_softmax',
        'test_masked_softmax_TxT_layout',
        'test_masked_softmax_devices_parity',
        'test_masked_softmax_forward_with_nans',
        'test_masked_softmax_grad',
        'test_masked_softmax_mask_types',
        'test_masked_softmax_transformer_layout',
        'test_mish_inplace_overlap',
        'test_module_to_empty',
        'test_multi_margin_loss_errors',
        'test_nn_empty',
        'test_nn_scalars',
        'test_nn_scalars_reductions',
        'test_nonlinearity_propagate_nan',
        'test_one_hot',
        'test_overwrite_module_params_on_conversion_cpu_device',
        'test_pad',
        'test_prelu_backward_32bit_indexing',
        'test_rnn_fused',
        'test_rnn_retain_variables',
        'test_save_lstm_compatibility',
        'test_silu_inplace_overlap',
        'test_skip_init',
        'test_smooth_l1_loss_bfloat16',
        'test_smooth_l1_loss_vs_huber_loss',
        'test_softmax',
        'test_softmax_64bit_indexing',
        'test_softmax_bfloat16',
        'test_softmax_results',
        'test_softplus_inplace_overlap',
        'test_softplus_low_threshold',
        'test_softshrink',
        'test_softshrink_inplace_overlap',
        'test_softshrink_negative',
        'test_threshold_inplace_overlap',
        'test_to_complex',
        'test_transformerencoderlayer',
        'test_transformerencoderlayer_fast_path',
        'test_transformerencoderlayer_gelu',
        'test_triplet_margin_with_distance_loss',
        'test_triplet_margin_with_distance_loss_default_parity',
        'test_upsamplingBiLinear2d_consistency',
        'test_upsamplingBiMode2d',
        'test_upsamplingBicubic2d_aa_correctness',
        'test_upsamplingBicubic2d_correctness',
        'test_upsamplingBilinear2d_aa_correctness',
        'test_upsamplingNearest1d',
        'test_upsamplingNearest1d_correctness',
        'test_upsamplingNearest1d_launch_config',
        'test_upsamplingNearest2d',
        'test_upsamplingNearest2d_correctness',
        'test_upsamplingNearest2d_launch_config',
        'test_upsamplingNearest2d_launch_fail',
        'test_upsamplingNearest2d_launch_rocm',
        'test_upsamplingNearest3d',
        'test_upsamplingNearest3d_correctness',
        'test_upsamplingNearest3d_launch_config',
        'test_upsamplingNearestExact1d_correctness',
        'test_upsamplingNearestExact1d_rescale',
        'test_upsamplingNearestExact2d_correctness',
        'test_upsamplingNearestExact3d_correctness',
        'test_upsamplingTrilinear3d',
        'test_upsampling_64bit_indexing_channels_last',
        'test_variable_sequence',
        'test_warp_softmax_64bit_indexing',
    },
    
    # test/test_shape_ops.py
    'TestShapeOpsDIPU': {
        'test_complex_rot90',
        'test_diag',
        'test_diagonal',
        'test_diagonal_multidim',
        'test_flip',
        'test_flip_errors',
        'test_flip_large_tensor',
        'test_flip_numpy',
        'test_fliplr',
        'test_fliplr_invalid',
        'test_flipud',
        'test_flipud_invalid',
        'test_movedim',
        'test_movedim_invalid',
        'test_rot90',
        'test_sparse_dense_dim',
        'test_tolist',
        'test_trace',
        'test_unbind',
    },
    
    # test/test_reductions.py
    'TestReductionsDIPU': {
        'test_identity',
        'test_nan_policy_propagate',
        'test_nan_policy_omit',
        'test_result_dtype',
        'test_empty_tensor_empty_slice',
        'test_empty_tensor_nonempty_slice',
        'test_noncontiguous_innermost',
        'test_noncontiguous_outermost',
        'test_noncontiguous_all',
        'test_noncontiguous_transposed',
        'test_ref_scalar_input',
        'test_ref_small_input',
        'test_ref_large_input_1D',
        'test_ref_large_input_2D',
        'test_ref_large_input_64bit_indexing',
        'test_ref_duplicate_values',
        'test_ref_extremal_values',
        'test_var_unbiased',
        'test_var_stability',
        'test_dim_reduction_less_than_64',
        'test_dim_reduction_lastdim',
        'test_logsumexp',
        'test_logcumsumexp_complex',
        'test_numpy_named_args',
        'test_std_dim',
        'test_var_dim',
        'test_logsumexp_dim',
        'test_prod_integer_upcast',
        'test_cumsum_integer_upcast',
        'test_cumprod_integer_upcast',
        'test_mode',
        'test_mode_large',
        'test_mode_boolean',
        'test_mode_wrong_dtype',
        'test_mode_wrong_device',
        'test_amin',
        'test_amax',
        'test_aminmax',
        'test_bincount',
        'test_var_stability2',
        'test_prod_gpu',
        'test_prod',
        'test_prod_bool',
        'test_bucketization',
        'test_nansum',
        'test_count_nonzero',
        'test_nansum_vs_numpy',
        'test_nansum_complex',
        'test_nansum_out_dtype',
        'test_argminmax_multiple',
        'test_repeated_dim',
        'test_var',
        'test_var_large_input',
        'test_minmax_illegal_dtype',
        'test_dim_arg_reduction_scalar',
        'test_dim_reduction',
        'test_reduction_split',
        'test_reduction_vectorize_along_input_corner',
        'test_reduction_vectorize_along_output',
        'test_argminmax_large_axis',
        'test_argminmax_axis_with_dim_one',
        'test_median_real_values',
        'test_median_nan_values',
        'test_median_corner_cases',
        'test_quantile',
        'test_quantile_backward',
        'test_quantile_error',
        'test_var_vs_numpy',
        'test_std_vs_numpy',
        'test_var_correction_vs_numpy',
        'test_std_correction_vs_numpy',
        'test_amin_amax_some_dims',
        'test_histc',
        'test_tensor_compare_ops_empty',
        'test_tensor_compare_ops_argmax_argmix_kthvalue_dim_empty',
        'test_reduce_dtype',
        'test_reference_masked',
        'test_reductions_large_half_tensors'
    },
    
    # test/test_sparse.py
    'TestSparseUnaryUfuncsDIPU': {
        'test_inplace',
        'test_out',
        'test_sparse_consistency',
        'test_sparse_fn_grad',
        'test_sparse_zero_dims',
        'test_sparse_zeros',
    },
    
    # test/test_sparse.py
    'TestSparseMaskedReductionsDIPU': {
        'test_future_empty_dim',
    },
    
    # test/test_sparse.py
    'TestSparseDIPU': {
        'test_Sparse_to_Sparse_copy_',
        'test_Sparse_to_Sparse_copy_multi_gpu',
        'test_asin_arcsin',
        'test_assign',
        'test_basic',
        'test_basic_ops',
        'test_bmm',
        'test_bmm_cuda_version_error',
        'test_bmm_deterministic',
        'test_bmm_windows_error',
        'test_change_tensor_metadata',
        'test_clone',
        'test_coalesce',
        'test_coalesce_reference_cycle',
        'test_coalesce_transpose_mm',
        'test_constructor_device_legacy',
        'test_contig',
        'test_contig_hybrid',
        'test_ctor_large_sizes',
        'test_ctor_size_checks',
        'test_cuda_empty',
        'test_dsmm',
        'test_dtypes',
        'test_empty_full',
        'test_empty_like',
        'test_factory',
        'test_factory_copy',
        'test_factory_default',
        'test_factory_dense_dim',
        'test_factory_device_type_inference',
        'test_factory_empty_indices',
        'test_factory_nnz',
        'test_factory_nnz_zero',
        'test_factory_size_check',
        'test_factory_type_inference',
        'test_full_broadcast_to',
        'test_hsmm',
        'test_index_select',
        'test_index_select_empty_and_non_contiguous_index',
        'test_index_select_exhaustive_index_large',
        'test_index_select_exhaustive_index_small',
        'test_index_select_parallelization',
        'test_is_nonzero',
        'test_is_sparse',
        'test_isnan',
        'test_legacy_constructor',
        'test_legacy_new',
        'test_log1p',
        'test_mm',
        'test_mv',
        'test_narrow',
        'test_neg_negative',
        'test_new',
        'test_new_device_multi_gpu',
        'test_new_device_single_gpu',
        'test_norm',
        'test_pickle',
        'test_print_coalesced',
        'test_print_uncoalesced',
        'test_resize',
        'test_resize_as',
        'test_saddmm',
        'test_same_gpu',
        'test_scalar',
        'test_select',
        'test_select_no_type_promotion',
        'test_shared',
        'test_small_nnz_coalesced',
        'test_softmax',
        'test_softmax_zero_nnz',
        'test_spadd',
        'test_sparse_bool',
        'test_sparse_broadcast_to',
        'test_sparse_dense_mul',
        'test_sparse_mask',
        'test_sparse_mask_hybrid',
        'test_sparse_matmul',
        'test_sparse_mm',
        'test_sparse_mul',
        'test_sparse_sparse_mul',
        'test_sparse_spdiags',
        'test_sparse_to_numpy',
        'test_sspaddmm',
        'test_storage_not_null',
        'test_t_empty',
        'test_to_dense',
        'test_to_dense_hybrid',
        'test_to_sparse',
        'test_transpose',
        'test_unsqueeze',
        'test_zeros',
        'test_zeros_like',
    },
    
    # test/test_sparse.py
    'TestSparseAnyDIPU': {
        'test_check_sparse_tensor_invariants',
        'test_generate_simple_inputs',
        'test_reductions',
        'test_reductions_backward',
        'test_to_dense',
        'test_to_sparse',
        'test_unsupported_backend_error_message',
    },
    
    # test/test_sort_and_select.py
    'TestSortAndSelectDIPU': {
        'test_stable_sort',
        'test_sort_restride',
        'test_sort_discontiguous',
        'test_sort_discontiguous_slow',
        'test_sort_1d_output_discontiguous',
        'test_stable_sort_against_numpy',
        'test_msort',
        'test_sort_expanded_tensor',
        'test_kthvalue',
        'test_kthvalue_scalar',
        'test_isin',
        'test_isin_different_dtypes',
        'test_isin_different_devices',
    },
    
    # test/test_torch.py
    'TestVitalSignsCudaDIPU': {
        'test_cuda_vitals_gpu_only',
    },
    
    # test/test_torch.py
    'TestTensorDeviceOpsDIPU': {
        
    },
    
    # test/test_torch.py
    'TestTorchDeviceTypeDIPU': {
        'test_addcdiv',
        'test_addcmul',
        'test_assertRaisesRegex_ignore_msg_non_native_device',
        'test_bernoulli_edge_cases',
        'test_bernoulli_mem_overlap',
        'test_bernoulli_p',
        'test_bernoulli_self',
        'test_bfloat16_float_copy',
        'test_bool_tensor_value_change',
        'test_broadcast',
        'test_bytes_to_scalar',
        'test_cauchy',
        'test_cauchy_kstest',
        'test_cauchy_no_inf',
        'test_cdist_cuda_backward',
        'test_cdist_empty',
        'test_cdist_euclidean_large',
        'test_cdist_grad_p_lt_1_no_nan',
        'test_cdist_large',
        'test_cdist_large_batch',
        'test_cdist_non_contiguous',
        'test_cdist_non_contiguous_batch',
        'test_cdist_norm',
        'test_cdist_norm_batch',
        'test_cdist_same_inputs',
        'test_check_tensor',
        'test_clone_all_dtypes_and_devices',
        'test_clone_not_memory_dense',
        'test_clone_zero_stride_dim',
        'test_complex_half_experimental_warning',
        'test_constants',
        'test_conv_transposed_backward_agnostic_to_memory_format',
        'test_conv_transposed_large',
        'test_copy_',
        'test_copy_all_dtypes_and_devices',
        'test_copy_math_view',
        'test_copy_mem_overlap',
        'test_copy_transpose_math_view',
        'test_corrcoef',
        'test_cov',
        'test_cpp_warnings_have_python_context',
        'test_cublas_config_nondeterministic_alert',
        'test_cummax_cummin',
        'test_cummax_discontiguous',
        'test_cummin_discontiguous',
        'test_cumprod',
        'test_cumsum',
        'test_deepcopy',
        'test_deepcopy_scalar',
        'test_device_guard',
        'test_diff',
        'test_diff_noncontig',
        'test_dim_function_empty',
        'test_discontiguous_out_cumsum',
        'test_dist',
        'test_errors_index_copy',
        'test_expected_failure_xla',
        'test_exponential',
        'test_exponential_kstest',
        'test_exponential_no_zero',
        'test_gather_backward_deterministic_path',
        'test_gather_backward_one_dim',
        'test_geometric',
        'test_geometric_kstest',
        'test_gradient_all',
        'test_gradient_extreme_cases',
        'test_gradient_type_promotion',
        'test_hook_remove',
        'test_index_copy',
        'test_index_copy_deterministic',
        'test_index_copy_mem_overlap',
        'test_index_copy_scalars',
        'test_index_fill',
        'test_index_fill_mem_overlap',
        'test_index_put_mem_overlap',
        'test_index_put_non_accumulate_deterministic',
        'test_index_reduce',
        'test_index_select',
        'test_invalid_shapes_grid_sampler',
        'test_is_set_to',
        'test_is_signed',
        'test_item',
        'test_large_cumprod',
        'test_large_cumsum',
        'test_log_normal',
        'test_logcumsumexp',
        'test_lognormal_kstest',
        'test_masked_fill',
        'test_masked_fill_bool_tensor',
        'test_masked_fill_mem_overlap',
        'test_masked_scatter',
        'test_masked_scatter_bool_tensor',
        'test_masked_scatter_large_tensor',
        'test_masked_scatter_mem_overlap',
        'test_masked_select',
        'test_masked_select_discontiguous',
        'test_memory_format_clone',
        'test_memory_format_consistency',
        'test_memory_format_cpu_and_cuda_ops',
        'test_memory_format_empty_like',
        'test_memory_format_factory_like_functions_preserve',
        'test_memory_format_operators',
        'test_memory_format_propagation_rules',
        'test_memory_format_to',
        'test_memory_format_type',
        'test_memory_format_type_shortcuts',
        'test_module_share_memory',
        'test_multinomial',
        'test_multinomial_cpu',
        'test_multinomial_deterministic',
        'test_multinomial_device_constrain',
        'test_multinomial_empty_w_replacement',
        'test_multinomial_empty_wo_replacement',
        'test_multinomial_gpu_device_constrain',
        'test_multinomial_rng_state_advance',
        'test_narrow_copy_non_contiguous',
        'test_narrow_empty',
        'test_nondeterministic_alert_AdaptiveAvgPool3d',
        'test_nondeterministic_alert_AdaptiveMaxPool2d',
        'test_nondeterministic_alert_AvgPool3d',
        'test_nondeterministic_alert_CTCLoss',
        'test_nondeterministic_alert_EmbeddingBag_max',
        'test_nondeterministic_alert_FractionalMaxPool2d',
        'test_nondeterministic_alert_FractionalMaxPool3d',
        'test_nondeterministic_alert_MaxPool3d',
        'test_nondeterministic_alert_MaxUnpool1d',
        'test_nondeterministic_alert_MaxUnpool2d',
        'test_nondeterministic_alert_MaxUnpool3d',
        'test_nondeterministic_alert_ReflectionPad1d',
        'test_nondeterministic_alert_ReflectionPad2d',
        'test_nondeterministic_alert_ReflectionPad3d',
        'test_nondeterministic_alert_ReplicationPad1d',
        'test_nondeterministic_alert_ReplicationPad2d',
        'test_nondeterministic_alert_ReplicationPad3d',
        'test_nondeterministic_alert_bincount',
        'test_nondeterministic_alert_cumsum',
        'test_nondeterministic_alert_grid_sample_2d',
        'test_nondeterministic_alert_grid_sample_3d',
        'test_nondeterministic_alert_histc',
        'test_nondeterministic_alert_interpolate_bicubic',
        'test_nondeterministic_alert_interpolate_bilinear',
        'test_nondeterministic_alert_interpolate_linear',
        'test_nondeterministic_alert_interpolate_trilinear',
        'test_nondeterministic_alert_kthvalue',
        'test_nondeterministic_alert_median',
        'test_nondeterministic_alert_put',
        'test_nondeterministic_alert_put_accumulate',
        'test_normal_kstest',
        'test_nullary_op_mem_overlap',
        'test_pairwise_distance_empty',
        'test_pdist_empty',
        'test_pdist_norm_large',
        'test_pickle_gradscaler',
        'test_pin_memory_from_constructor',
        'test_put',
        'test_put_accumulate',
        'test_put_empty',
        'test_put_mem_overlap',
        'test_repeat_interleave',
        'test_scalar_check',
        'test_scatter_add_bool',
        'test_scatter_add_non_unique_index',
        'test_scatter_add_one_dim_deterministic',
        'test_scatter_add_to_large_input',
        'test_scatter_bool',
        'test_scatter_mem_overlap',
        'test_scatter_reduce_multiply_unsupported_dtypes',
        'test_scatter_reduce_non_unique_index',
        'test_scatter_reduce_operations_to_large_input',
        'test_scatter_reduce_scalar',
        'test_scatter_to_large_input',
        'test_scatter_zero_size_index',
        'test_serialization',
        'test_set_storage',
        'test_shift_mem_overlap',
        'test_skip_xla',
        'test_storage',
        'test_storage_all_devices',
        'test_storage_meta_errors',
        'test_storage_meta_from_tensor',
        'test_storage_setitem',
        'test_strides_propagation',
        'test_sync_warning',
        'test_take',
        'test_take_empty',
        'test_tensor_from_storage',
        'test_tensor_set_errors_multigpu',
        'test_tensor_shape_empty',
        'test_tensor_storage_type',
        'test_ternary_op_mem_overlap',
        'test_typed_storage_meta',
        'test_unfold_all_devices_and_dtypes',
        'test_unfold_scalars',
        'test_uniform_kstest',
        'test_untyped_storage_meta',
        'test_warn_always_caught',
    },
    
    # test/test_torch.py
    'TestDevicePrecisionDIPU': {
        'test_advancedindex_mixed_cpu_devices',
        'test_advancedindex_mixed_devices_error',
        'test_copy_broadcast',
        'test_copy_noncontig',
        'test_cuda_device_idx',
        'test_device_serialization',
        'test_from_sequence',
        'test_index_add_bfloat16',
        'test_multidevice_serialization',
        'test_type_conversions_same_device',
    }
}

DISABLED_TESTS = common_utils.prepare_match_set(DISABLED_TESTS_MLU)
